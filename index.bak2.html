<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bus Location</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html, body { height: 100%; padding: 0; margin: 0; }
        #map { height: 100%; width: 100vw; }
        .erroralert {
            display: none;
            text-align: center;
            padding: 20px;
            background-color: #bb0d00;
            margin-bottom: 20px;
            font-weight: 900;
            color: white;
        }
    </style>
    <script src="./static/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="./static/leaflet.css"/>
    <script src="./static/leaflet.js"></script>
    <script src="./static/leaflet.geometryutil.js"></script>
    <script src="./static/SmoothWheelZoom.js"></script>
    <script src="./static/leaflet.rotatedMarker.js"></script>
    <script src="./static/script.js"></script>
</head>
<body>
<div class="erroralert"></div>
<div id="map"></div>
<script>
    var map = L.map('map', {
        scrollWheelZoom: false,
        smoothWheelZoom: true,
        smoothSensitivity: 1,

    }).setView([59.50169484910924, 17.672710418701175], 13);

    map.scrollWheelZoom = true;

    var busIcon = L.icon({
        iconUrl: './static/bus_top_blue.png',
        //shadowUrl: 'leaf-shadow.png',

        iconSize:     [13*(7.5/4), 13*(18.5/4)], // size of the icon
        //shadowSize:   [50, 64], // size of the shadow
        //iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
        //shadowAnchor: [4, 62],  // the same for the shadow
        //popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
    });


    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        maxZoom: 20,
        minZoom: 1,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoiaGFzc2FuaWxhOTciLCJhIjoiY2tqaGJyNjA1NHhraDJybGdwNnM0bXc2ZiJ9.2vghkHcqkPSknBmLyWMicQ'
    }).addTo(map);

    let marker = L.marker([59.50169484910924, 17.672710418701175], {icon: busIcon}).addTo(map);

    marker.setRotationAngle(120).setRotationOrigin('center center').bindPopup("<b>Hello world!</b><br>I am a popup.");


    map.on('zoomend', function() {
        var currentZoom = map.getZoom();

        if (currentZoom % 1 !== 0) {
            //return map.setZoom(Math.round(currentZoom));
        }

        let busIcon2 =  new L.DivIcon({
            html: '<div class="container" style="position: relative;' +
                '  text-align: center;' +
                'font-size: 20px;' +
                '  color: white;">' + (new L.Icon({
                    iconUrl: './static/bus_top_blue.png',
                    iconSize:     [currentZoom*(7.5/4), currentZoom*(18.5/4)],
                })).createIcon().outerHTML + '<div class="centered" style="position: absolute;' +
                '  transform: translate(-50%, -50%) rotate(-90deg);">3281</div></div>'
        })



        marker.setIcon(busIcon2);

        marker.setRotationAngle(120).setRotationOrigin('center center');
    });

</script>
</body>
</html>